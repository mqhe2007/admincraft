<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>插件 | Admincraft</title>
    <meta name="description" content="中后台应用快速搭建工具">
    
    
    <link rel="preload" href="/admincraft/assets/css/0.styles.01a8d6d9.css" as="style"><link rel="preload" href="/admincraft/assets/js/app.1fdd1679.js" as="script"><link rel="preload" href="/admincraft/assets/js/4.5150e570.js" as="script"><link rel="prefetch" href="/admincraft/assets/js/10.4062a110.js"><link rel="prefetch" href="/admincraft/assets/js/11.9464ee89.js"><link rel="prefetch" href="/admincraft/assets/js/12.6093ce8a.js"><link rel="prefetch" href="/admincraft/assets/js/2.6273f23d.js"><link rel="prefetch" href="/admincraft/assets/js/3.eb50e702.js"><link rel="prefetch" href="/admincraft/assets/js/5.4385c338.js"><link rel="prefetch" href="/admincraft/assets/js/6.5416b19d.js"><link rel="prefetch" href="/admincraft/assets/js/7.3896eef9.js"><link rel="prefetch" href="/admincraft/assets/js/8.2e616cf2.js"><link rel="prefetch" href="/admincraft/assets/js/9.605e5157.js">
    <link rel="stylesheet" href="/admincraft/assets/css/0.styles.01a8d6d9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/admincraft/" class="home-link router-link-active"><!----> <span class="site-name">Admincraft</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/admincraft/guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/admincraft/options/" class="nav-link">配置</a></div><div class="nav-item"><a href="/admincraft/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/admincraft/ui/" class="nav-link">组件</a></div><div class="nav-item"><a href="/admincraft/appendix/" class="nav-link">附录</a></div><div class="nav-item"><a href="/admincraft/qa/" class="nav-link">常见问题</a></div><div class="nav-item"><a href="https://github.com/mqhe2007/admincraft" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/admincraft/guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/admincraft/options/" class="nav-link">配置</a></div><div class="nav-item"><a href="/admincraft/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/admincraft/ui/" class="nav-link">组件</a></div><div class="nav-item"><a href="/admincraft/appendix/" class="nav-link">附录</a></div><div class="nav-item"><a href="/admincraft/qa/" class="nav-link">常见问题</a></div><div class="nav-item"><a href="https://github.com/mqhe2007/admincraft" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><h1 id="插件"><a href="#插件" aria-hidden="true" class="header-anchor">#</a> 插件</h1> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>本页面文档持续撰写中，请关注。</p></div> <p>使用插件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token template-string"><span class="token string">`dashboard/src/plugins/**/*.js`</span></span>
</code></pre></div><h2 id="模块加载器（module-loader）"><a href="#模块加载器（module-loader）" aria-hidden="true" class="header-anchor">#</a> 模块加载器（module-loader）</h2> <p>前面我们说了，我们需要把业务模块进行解耦拆分，当我们需要的时候在动态加载过来。模块加载器的作用就是按需加载打包成<a href="https://cli.vuejs.org/zh/guide/build-targets.html#%E5%BA%93" target="_blank" rel="noopener noreferrer">umd-lib<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的vue模块。</p> <p>特性如下：</p> <ul><li><p>判断模块是否已经加载，避免重复请求加载。</p></li> <li><p>通过创建<code>script</code>标签方式加载模块文件，避免跨域配置。</p></li> <li><p>自动注册模块数据。</p></li> <li><p>友好的错误提示。</p></li></ul> <p>那么先让我们看看一个完整的模块加载过程：</p> <ol><li><p>当我们访问一个路由时，我们提前设置的路由前守卫会获取到 to, from, next<a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%AE%88%E5%8D%AB" target="_blank" rel="noopener noreferrer">三个参数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></li> <li><p>通过<a href="https://router.vuejs.org/zh/api/#%E8%B7%AF%E7%94%B1%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7" target="_blank" rel="noopener noreferrer">to.matched<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>属性的值判断当前要前往的路由有没有匹配到 vue 组件。如果匹配到目标组件，路由会直接调用<code>next()</code>方法进入相应路由；如果没有匹配到目标组件，则说明应用中还没有加载此路由需要的模块，应用则会尝试从<a href="/admincraft/options/#模块库">模块库</a>中查询模块的加载地址，加载这个模块。</p></li> <li><p>模块请求成功后通过<code>module-loader</code>注册到框架并重新进行路由导航。</p></li></ol> <p><img src="/admincraft/assets/img/process.4ef8a5bf.png" alt="process"></p> <h3 id="api"><a href="#api" aria-hidden="true" class="header-anchor">#</a> API</h3> <p>模块加载后，主框架<code>module-loader</code>的<code>register</code>工具会自动把 API 定义合并进 Vue 原型的<code>$api</code>对象里：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 加载时注册</span>
register<span class="token punctuation">.</span><span class="token function">api</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">,</span> moduleApi<span class="token punctuation">)</span>
</code></pre></div><p><code>api</code>注册方法接受两个参数：</p> <ul><li>moduleName</li></ul> <p>类型：<code>String</code></p> <p>合并成功的模块 API 会以模块名称为 key，API 方法为 value，所以我们调用时要以模块名为命名空间进行使用。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 调用</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$api<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span>
  <span class="token punctuation">.</span><span class="token function">getSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>moduleApi</li></ul> <p>类型： <code>object</code></p> <p>模块导出并加载到主框架的 API 方法对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 导出到模块build.js并打包</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  getSomething<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token constant">API_BASE</span> <span class="token operator">+</span> <span class="token string">'get.json'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="store"><a href="#store" aria-hidden="true" class="header-anchor">#</a> store</h3> <p>模块加载后，主框架<code>module-loader</code>的<code>register</code>工具会自动把模块的 store 合并进主框架的 vuex：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 加载时注册</span>
register<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">,</span> moduleStore<span class="token punctuation">)</span>
</code></pre></div><p><code>store</code>注册方法接受两个参数：</p> <ul><li>moduleName</li></ul> <p>类型：<code>String</code></p> <p>合并成功的 store 会开启<a href="https://vuex.vuejs.org/zh/guide/modules.html#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4" target="_blank" rel="noopener noreferrer">命名空间<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，所以我们调用时要以模块名为命名空间进行使用。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 调用</span>
<span class="token keyword">let</span> something <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span><span class="token punctuation">.</span>something
</code></pre></div><ul><li>moduleStore</li></ul> <p>类型： <code>object</code></p> <p>模块导出并加载到主框架的 store 定义对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 导出到模块build.js并打包</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  namespaced<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  state<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    something<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">setSomething</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>something <span class="token operator">=</span> payload
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="routes"><a href="#routes" aria-hidden="true" class="header-anchor">#</a> routes</h3> <p>模块加载后，主框架<code>module-loader</code>的<code>register</code>工具会自动把模块的 routes 合并进主框架的 router：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 加载时注册</span>
register<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span>moduleRoutes<span class="token punctuation">)</span>
</code></pre></div><p>每个模块的路由定义都是一个顶级路由和若干子路由组成的<a href="https://router.vuejs.org/zh/guide/essentials/nested-routes.html" target="_blank" rel="noopener noreferrer">嵌套路由<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>所以我们访问页面时的 url 也会通过模块名进行区分：<code>http://localhost/moduleName/page1</code></p> <p><code>routes</code>注册方法接受一个参数：</p> <ul><li>moduleRoutes</li></ul> <p>类型： <code>array</code></p> <p>模块导出并加载到主框架的 routes 定义数组</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 导出到模块build.js并打包</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">'/moduleName'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> ModuleHome<span class="token punctuation">,</span>
  <span class="token comment">// 路由元数据，包含路由扩展配置信息</span>
  meta<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'模块标题'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'page1'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> ModulePage1<span class="token punctuation">,</span>
    meta<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">'模块页面1'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="components"><a href="#components" aria-hidden="true" class="header-anchor">#</a> components</h3> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>此处的<code>components</code>是指那些非路由组件。一般是一些局部页面或系统全局公用的组件。</p></div> <p>模块加载后，主框架<code>module-loader</code>的<code>register</code>工具会自动把模块的 components 注册为全局组件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 加载时注册</span>
register<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>moduleComponents<span class="token punctuation">)</span>
</code></pre></div><p>模块携带过来的全局组件中必须声明<code>frameSlot</code>属性，指明插入的主框架插槽名称才可正常加载。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 注册非路由组件</span>
<span class="token function">component</span><span class="token punctuation">(</span>components<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> componentName <span class="token keyword">in</span> components<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>components<span class="token punctuation">[</span>componentName<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> components<span class="token punctuation">[</span>componentName<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// 关键点-把模块携带过来的组件加入插槽组件列表</span>
    store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'frameSlot/add'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">:</span> components<span class="token punctuation">[</span>componentName<span class="token punctuation">]</span><span class="token punctuation">.</span>frameSlot<span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> components<span class="token punctuation">[</span>componentName<span class="token punctuation">]</span><span class="token punctuation">.</span>name
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>插槽通过预先定义的插槽组件和动态组件实现</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slot-global<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 通过动态组件渲染组件 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span>
      <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(name, index) in components<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'slotGlobal'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      components<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从插槽state中读取组件列表</span>
    <span class="token string">'$store.state.frameSlot.global'</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>components <span class="token operator">=</span> n
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="menus"><a href="#menus" aria-hidden="true" class="header-anchor">#</a> menus</h3> <p>主框架侧边栏菜单支持动态添加。</p> <p>模块加载后，主框架<code>module-loader</code>的<code>register</code>工具会自动为模块注册菜单：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>register<span class="token punctuation">.</span><span class="token function">sideMenu</span><span class="token punctuation">(</span>moduleRoutes<span class="token punctuation">)</span>
</code></pre></div><p>菜单数据来源于路由对象，默认状态下路由都会注册为菜单，只有在定义路由对象时在<code>meta</code>对象中声明<code>notMenu</code>属性值为<code>true</code>时才不会注册为菜单。</p> <p>菜单默认按照路由配置顺序排序，当在<code>meta</code>对象中声明<code>index</code>属性时，将按照序号进行排序。</p> <p>详见：<a href="/admincraft/code/#路由元数据">路由元数据配置</a></p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>在嵌套路由中，如果在父级路由<code>meta</code>中添加<code>notMenu: true</code>，则其子路由都不会被注册为菜单。</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">'/pm'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> pm<span class="token punctuation">,</span>
  meta<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'企业管理'</span><span class="token punctuation">,</span> <span class="token comment">// 菜单名称</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'tenantManagement'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> TenantManagement<span class="token punctuation">,</span>
      meta<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">'租户队列管理'</span><span class="token punctuation">,</span> <span class="token comment">// 菜单名称</span>
        notMenu<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 使用 notMenu 属性声明此路不需要注册为菜单</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token operator">...</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="事件总线"><a href="#事件总线" aria-hidden="true" class="header-anchor">#</a> 事件总线</h2> <p>引用路径：<code>dashboard/src/plugins/event-bus.js</code></p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>模块与框架，模块与模块间的数据传递请在 vuex 中声明相关 mutation 方法或者 action 方法。<code>eventBus</code>仅做轻量级的业务事件监听。</p></div> <p>事件总线本质上是 Vue 原型对象上的一个对象<code>eventBus</code>，我们可以用来监听和触发一些事件。</p> <p>每个模块需要提供自己的事件列表以供其他模块监听。反之，也可根据其他模块提供的事件列表按需监听。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 原型对象</span>
Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$eventBus <span class="token operator">=</span> <span class="token punctuation">{</span>
  emit<span class="token punctuation">,</span>
  on<span class="token punctuation">,</span>
  off
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'someEvnet'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre></div><p>比如：</p> <p>模块触发一个业务成功事件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// do something…</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'callOver'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>其他模块或主框架在需要监听此事件的组件中监听：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'callOver'</span><span class="token punctuation">,</span> payload <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// payload为触发时emit携带的数据</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>取消某一事件监听：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'callOver'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="自定义指令库"><a href="#自定义指令库" aria-hidden="true" class="header-anchor">#</a> 自定义指令库</h2> <p>引用路径：<code>dashboard/src/plugins/directive.js</code></p> <p>框架提供若干具有特殊能力的<a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener noreferrer">自定义指令<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，各个模块按需引用。</p> <h3 id="使用"><a href="#使用" aria-hidden="true" class="header-anchor">#</a> 使用</h3> <ol><li>在<code>main.js</code>中导入</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">'dashboard/src/plugins/directive.js'</span>
</code></pre></div><p>导入之后，<code>directive</code>库会自动在 Vue 全局注册自定义指令，我们可以直接在组件中使用。</p> <ol start="2"><li>在组件中使用</li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-permission</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>permissionTag<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="指令列表"><a href="#指令列表" aria-hidden="true" class="header-anchor">#</a> 指令列表</h3> <ul><li><h4 id="元素鉴权"><a href="#元素鉴权" aria-hidden="true" class="header-anchor">#</a> 元素鉴权</h4></li></ul> <p>指令：<code>v-permission</code></p> <p><a href="#%E8%8E%B7%E5%8F%96%E5%89%8D%E7%BD%AE%E6%95%B0%E6%8D%AE">前置数据</a>：<code>store.state.user.permissions</code></p> <p>根据当前登录用户的权限列表控制元素现实与否。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">v-permission</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>permissionTag<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>permissionTag</code>的可选值参考权限列表。</p> <h2 id="系统提示音"><a href="#系统提示音" aria-hidden="true" class="header-anchor">#</a> 系统提示音</h2> <p>引用路径：<code>dashboard/src/plugins/sys-sound.js</code></p> <p>各个模块可以使用<code>dashboard</code>模块中的系统声音库，为模块中的用户操作添加更加明确的操作反馈。</p> <h3 id="使用-2"><a href="#使用-2" aria-hidden="true" class="header-anchor">#</a> 使用</h3> <ol><li>在<code>main.js</code>中导入</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">'dashboard/src/plugins/sys-sound.js'</span>
</code></pre></div><p>导入之后，<code>sys-sound</code>库会自动在 Vue 原型对象上添加<code>$sysSound</code>对象，我们可以直接在实例中使用。</p> <ol start="2"><li>在组件中使用</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">onError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$sysSound<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">'failed'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="方法"><a href="#方法" aria-hidden="true" class="header-anchor">#</a> 方法</h3> <h4 id="play-soundname-string"><a href="#play-soundname-string" aria-hidden="true" class="header-anchor">#</a> .play(soundName: string)</h4> <p>播放声音，可选的声音名称见可选声音列表。</p> <h3 id="可选声音列表"><a href="#可选声音列表" aria-hidden="true" class="header-anchor">#</a> 可选声音列表</h3> <table><thead><tr><th style="text-align:center">名称</th> <th style="text-align:center">含义</th> <th style="text-align:center">预览</th></tr></thead> <tbody><tr><td style="text-align:center">failed</td> <td style="text-align:center">消极，失败</td> <td style="text-align:center"><audio src="http://172.18.238.202:8080/sound/failed.mp3" controls="controls" preload="metadata"></audio></td></tr> <tr><td style="text-align:center">whizzing</td> <td style="text-align:center">发送，穿越，穿梭</td> <td style="text-align:center"><audio src="http://172.18.238.202:8080/sound/whizzing.mp3" controls="controls" preload="metadata"></audio></td></tr> <tr><td style="text-align:center">bubble</td> <td style="text-align:center">小啵一声~</td> <td style="text-align:center"><audio src="http://172.18.238.202:8080/sound/bubble.mp3" controls="controls" preload="metadata"></audio></td></tr> <tr><td style="text-align:center">burst</td> <td style="text-align:center">大啵，破裂</td> <td style="text-align:center"><audio src="http://172.18.238.202:8080/sound/burst.mp3" controls="controls" preload="metadata"></audio></td></tr></tbody></table> <h2 id="路径别名"><a href="#路径别名" aria-hidden="true" class="header-anchor">#</a> 路径别名</h2> <p>单文件组件和 js 文件中，我们可以使用如下别名来减少目录的查找和定位，也能避免调整组件位置后重新修改路径的尴尬遭遇。</p> <table><thead><tr><th style="text-align:center">标识符</th> <th style="text-align:center">目标</th> <th style="text-align:center">使用范围</th></tr></thead> <tbody><tr><td style="text-align:center">@</td> <td style="text-align:center">/src</td> <td style="text-align:center">js 语句，template 块中必须结合 v-bind 使用 require('@/xxx')</td></tr> <tr><td style="text-align:center">@root</td> <td style="text-align:center">/</td> <td style="text-align:center">js 语句，template 块中必须结合 v-bind 使用 require('@/xxx')</td></tr> <tr><td style="text-align:center">~@</td> <td style="text-align:center">/src</td> <td style="text-align:center">style 块中</td></tr> <tr><td style="text-align:center">~@root</td> <td style="text-align:center">/</td> <td style="text-align:center">style 块中</td></tr></tbody></table> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>img <span class="token punctuation">:</span>src<span class="token operator">=</span><span class="token string">&quot;require('@root/static/img.png')&quot;</span><span class="token operator">&gt;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/admincraft/assets/js/app.1fdd1679.js" defer></script><script src="/admincraft/assets/js/4.5150e570.js" defer></script>
  </body>
</html>
