<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>指南 | Admincraft</title>
    <meta name="description" content="一个支持模块化分布部署和加载的 Vue Admin">
    
    
    <link rel="preload" href="/admincraft/assets/css/0.styles.8b4e8c53.css" as="style"><link rel="preload" href="/admincraft/assets/js/app.7cbdb45c.js" as="script"><link rel="preload" href="/admincraft/assets/js/3.4833b8e4.js" as="script"><link rel="prefetch" href="/admincraft/assets/js/10.7c87bb2d.js"><link rel="prefetch" href="/admincraft/assets/js/2.d44b6d39.js"><link rel="prefetch" href="/admincraft/assets/js/4.55ac6171.js"><link rel="prefetch" href="/admincraft/assets/js/5.8e933859.js"><link rel="prefetch" href="/admincraft/assets/js/6.6d43f95f.js"><link rel="prefetch" href="/admincraft/assets/js/7.07580420.js"><link rel="prefetch" href="/admincraft/assets/js/8.2cf949aa.js"><link rel="prefetch" href="/admincraft/assets/js/9.5f4448cb.js">
    <link rel="stylesheet" href="/admincraft/assets/css/0.styles.8b4e8c53.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/admincraft/" class="home-link router-link-active"><!----> <span class="site-name">Admincraft</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/admincraft/guide/" class="nav-link router-link-exact-active router-link-active">指南</a></div><div class="nav-item"><a href="/admincraft/options/" class="nav-link">配置</a></div><div class="nav-item"><a href="/admincraft/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/admincraft/ui/" class="nav-link">UI</a></div><div class="nav-item"><a href="/admincraft/appendix/" class="nav-link">附录</a></div><div class="nav-item"><a href="/admincraft/qa/" class="nav-link">常见问题</a></div><div class="nav-item"><a href="https://github.com/mqhe2007/admincraft" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/admincraft/guide/" class="nav-link router-link-exact-active router-link-active">指南</a></div><div class="nav-item"><a href="/admincraft/options/" class="nav-link">配置</a></div><div class="nav-item"><a href="/admincraft/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/admincraft/ui/" class="nav-link">UI</a></div><div class="nav-item"><a href="/admincraft/appendix/" class="nav-link">附录</a></div><div class="nav-item"><a href="/admincraft/qa/" class="nav-link">常见问题</a></div><div class="nav-item"><a href="https://github.com/mqhe2007/admincraft" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/admincraft/guide/" class="active sidebar-link">指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/admincraft/guide/#内置工具库" class="sidebar-link">内置工具库</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#视图层次" class="sidebar-link">视图层次</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/admincraft/guide/#布局" class="sidebar-link">布局</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#页面" class="sidebar-link">页面</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#组件" class="sidebar-link">组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#admincraft-实例" class="sidebar-link">Admincraft 实例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/admincraft/guide/#挂载实例" class="sidebar-link">挂载实例</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#路由配置" class="sidebar-link">路由配置</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#状态配置" class="sidebar-link">状态配置</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#使用-vue-插件" class="sidebar-link">使用 Vue 插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#加载一个模块" class="sidebar-link">加载一个模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/admincraft/guide/#实例化前加载" class="sidebar-link">实例化前加载</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#运行时加载" class="sidebar-link">运行时加载</a></li></ul></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#编写一个模块" class="sidebar-link">编写一个模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/admincraft/guide/#目录约定" class="sidebar-link">目录约定</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#模块打包" class="sidebar-link">模块打包</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#模块开发" class="sidebar-link">模块开发</a></li></ul></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#事件总线" class="sidebar-link">事件总线</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/admincraft/guide/#触发事件" class="sidebar-link">触发事件</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#监听事件" class="sidebar-link">监听事件</a></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#取消监听" class="sidebar-link">取消监听</a></li></ul></li><li class="sidebar-sub-header"><a href="/admincraft/guide/#发起异步请求" class="sidebar-link">发起异步请求</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="指南"><a href="#指南" aria-hidden="true" class="header-anchor">#</a> 指南</h1> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>开始使用 Admincraft 前，我们假设您已经拥有了创建或使用 vue + webpack 工程的开发经验。</p></div> <p>Admincraft，名称借鉴自“Minecraft”。也是希望 Admincraft 能够像“Minecraft”一样成为一个灵活自由强大的开发工具，为中后台应用的快速开发寻找新的可能。</p> <p>Admincraft 在 Vue 已有 API 的基础上进行了更高级的 API 封装。令 Admincraft 支持除传统的单一工程开发外也支持模块化分离开发，开发完成的模块可以分布部署，并在另一个模块运行时热加载到主系统中。</p> <h2 id="内置工具库"><a href="#内置工具库" aria-hidden="true" class="header-anchor">#</a> 内置工具库</h2> <p>Admincraft 内置了下列工具库，无需再次安装。</p> <ul><li><p><a href="https://cn.vuejs.org" target="_blank" rel="noopener noreferrer">vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://vue-meta.nuxtjs.org/" target="_blank" rel="noopener noreferrer">vue-meta<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://router.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">vue-router<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">vuex<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">axios<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/ustbhuangyi/better-scroll" target="_blank" rel="noopener noreferrer">better-scroll<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h2 id="视图层次"><a href="#视图层次" aria-hidden="true" class="header-anchor">#</a> 视图层次</h2> <p>为了使应用的页面布局灵活多变，不局限为单一的控制台布局，Admincraft 自带的用户界面采用了<code>布局 &gt; 页面 &gt; 组件</code>的层级结构。如下图：</p> <p><img src="/admincraft/assets/img/level.1e7a8035.png" alt="level"></p> <h3 id="布局"><a href="#布局" aria-hidden="true" class="header-anchor">#</a> 布局</h3> <p>布局是系统最顶层的<a href="https://router.vuejs.org/zh/guide/essentials/nested-routes.html" target="_blank" rel="noopener noreferrer">路由出口<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。通过配置 Admincraft 布局，可以实现：控制台，空页面，错误等页面。</p> <p>在<a href="/admincraft/options/#路由选项配置">路由选项</a>中未配置<code>layout</code>选项时，Admincraft 默认布局名称为<code>layoutDefault</code>，会输出“布局未找到提示”，并且子路由页面不会被输出。</p> <p>可以使用 <a href="/admincraft/api/#app-addlayout">添加布局</a> API设置同名布局进行重设。</p> <h3 id="页面"><a href="#页面" aria-hidden="true" class="header-anchor">#</a> 页面</h3> <p>页面是路由渲染的目标组件，相当于传统项目中的<code>html</code>页面，一个页面由若干个组件联合构成。</p> <h3 id="组件"><a href="#组件" aria-hidden="true" class="header-anchor">#</a> 组件</h3> <p>这里所说的组件是指除布局，页面这些专用组件外，其他的<code>.vue</code>单文件组件。</p> <h2 id="admincraft-实例"><a href="#admincraft-实例" aria-hidden="true" class="header-anchor">#</a> Admincraft 实例</h2> <p>每个应用或模块都是通过<code>Admincraft</code>类创建一个新的 Admincraft 实例开始的，Admincraft 实例本质上是一个增强了 API 的 Vue 实例，同时具备 Vue 实例的所有属性和方法（有待尝试）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> admincraft <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Admincraft</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 选项</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>当创建一个 Admincraft 实例时，你可以传入一个选项对象作为实例化配置，详细选项请查看<a href="/admincraft/options/#实例化选项">实例化选项</a>。</p> <h3 id="挂载实例"><a href="#挂载实例" aria-hidden="true" class="header-anchor">#</a> 挂载实例</h3> <p>做完了以上那些内容，如果你启动一个开发服务，发现并不能在浏览器窗口中看到内容。因为当我们实例化 Admincraft 后仅仅是得到了一个存在于浏览器文档之外的实例对象：<code>admincraft</code>。我们接下来要做的就是使用 Vue 实例方法<code>$mount</code>把 Vue 实例挂载到一个 DOM 元素上。<a href="https://cn.vuejs.org/v2/api/#vm-mount" target="_blank" rel="noopener noreferrer">学习$mount<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>通常代码看起来是这个样子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token comment">/**
 * 是否新建元素取决于你想怎么做，如果你想挂载实例到一个已存在于你index.html文件中的元素上。
 * $mount方法同样可以接收一个选择器字符串作为参数。
 **/</span>
<span class="token keyword">let</span> admincraft <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Admincraft</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">'admincraft'</span><span class="token punctuation">,</span>
  logo<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    image<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  http<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
admincraft<span class="token punctuation">.</span>vue<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
</code></pre></div><p>刷新浏览器，此时应该可以看到 admincraft 的默认界面了。</p> <h3 id="路由配置"><a href="#路由配置" aria-hidden="true" class="header-anchor">#</a> 路由配置</h3> <p>通常我们使用 Vue 来做项目，实例化的同时就会传入 vue-router 配置。Admincraft 也是这么做的，只不过是发生在 Admincraft 内部，我们并不需要关心细节，而且借助于<code>addRoutes</code>API，我们可以在实例化之后再添加路由配置。</p> <p>通常我们新建一个路由配置文件，导出符合路由规范的数组。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>路由的 name 在 Admincraft 中非常重要。我们使用 name 进行路由导航，匹配菜单，匹配页签等，一定要记得配置，并且具有唯一性。</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// routes.js</span>
<span class="token keyword">import</span> Login <span class="token keyword">from</span> <span class="token string">'./views/Login.vue'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
    meta<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      NonMenu<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token string">'请登录'</span><span class="token punctuation">,</span>
      layout<span class="token punctuation">:</span> <span class="token string">'blank'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> Login
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">]</span>
</code></pre></div><p>导入路由配置并在 Admincraft 实例化后使用 api 添加到实例中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">'./routes'</span>
app<span class="token punctuation">.</span><span class="token function">$addRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p><strong>这里有个特殊情况：</strong>
为了实现<a href="/admincraft/guide/#首页配置">动态可变的控制台首页</a>，<code>/</code>，也就是根路由，已经在 Admincraft 内部配置，任何情况下都不要再次配置。</p></div> <h3 id="状态配置"><a href="#状态配置" aria-hidden="true" class="header-anchor">#</a> 状态配置</h3> <p>情况和路由配置类似，并且使用了<a href="https://vuex.vuejs.org/zh/guide/modules.html" target="_blank" rel="noopener noreferrer">Vuex 模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的概念，您必须掌握其使用方法。</p> <p>通常我们新建一个 Vuex 模块配置文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// store.js</span>
<span class="token keyword">const</span> storeModule <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  getters<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> storeModule
</code></pre></div><p>导入 Vuex 模块配置并在 Admincraft 实例化后使用 api 添加到实例中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> storeModule <span class="token keyword">from</span> <span class="token string">'./store'</span>
app<span class="token punctuation">.</span><span class="token function">$addStore</span><span class="token punctuation">(</span><span class="token string">'moduleName'</span><span class="token punctuation">,</span> storeModule<span class="token punctuation">)</span>
</code></pre></div><h3 id="使用-vue-插件"><a href="#使用-vue-插件" aria-hidden="true" class="header-anchor">#</a> 使用 Vue 插件</h3> <p>查看全局 API：<a href="/admincraft/api/#admincraft-use">Admincraft.use</a></p> <h2 id="加载一个模块"><a href="#加载一个模块" aria-hidden="true" class="header-anchor">#</a> 加载一个模块</h2> <p>在 Admincraft 项目中我们有两种方式加载模块。</p> <h3 id="实例化前加载"><a href="#实例化前加载" aria-hidden="true" class="header-anchor">#</a> 实例化前加载</h3> <p>Admincraft 实例化前可以通过<a href="/admincraft/api/#admincraft-add">Admincraft.add</a>方法添加一个模块。</p> <h3 id="运行时加载"><a href="#运行时加载" aria-hidden="true" class="header-anchor">#</a> 运行时加载</h3> <p>应用运行时在任何时候可以通过实例方法<a href="/admincraft/api/#app-moduleloader">$moduleLoader</a>进行加载。</p> <h2 id="编写一个模块"><a href="#编写一个模块" aria-hidden="true" class="header-anchor">#</a> 编写一个模块</h2> <p>借助于<a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vue-cli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>脚手架工具创建模块工程，我们很容易的把代码打包成一个 Admincraft 模块。</p> <p>一个 Admincraft 模块就是一个打包成 umd 规范的 js 库及相关资源。</p> <p>打包为库的配置请参考：<a href="https://cli.vuejs.org/zh/guide/build-targets.html" target="_blank" rel="noopener noreferrer">构建目标-库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>这里有一个带有完整演示的模块项目：<a href="https://github.com/mqhe2007/admincraft-module" target="_blank" rel="noopener noreferrer">Admincraft-module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="目录约定"><a href="#目录约定" aria-hidden="true" class="header-anchor">#</a> 目录约定</h3> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>注意，缩进代表目录层级。</p></div> <div class="language- extra-class"><pre class="language-text"><code>dist ----------------- 编译完成后的发行代码目录
node_modules --------- nodejs项目依赖安装目录
public --------------- 不需要webpack打包的静态资源目录
  libs --------------- 通过远程调用的第三方库目录
  index.html --------- 开发预览的网页入口文件
src ------------------ 源代码目录
  assets ------------- 需要webpack打包编译的资源目录
  components --------- 局部组件目录
  layout ------------- 布局组件目录
  router ------------- 路由配置目录
    routes.js -------- 路由配置
  store -------------- vuex状态管理配置
    storeModule.js --- vuex状态模块化配置
  views -------------- 视图组件目录，需要导入路由配置
  App.vue ------------ Vue实例根组件
  envConst ----------- 多环境常量配置
  init.js ------------ 模块初始化文件，模块化打包的入口文件
  libs.js ------------ 通过远程调用的第三方库清单文件
  main.js ------------ 开发服务入口文件
.browserslistrc ------ 浏览器支持情况配置
.env.* --------------- 构建环境与模式配置
.eslintrc.js --------- eslint的配置文件
.gitignore ----------- git 提交忽略文件
babel.config.js ------ babel编译配置文件
package.json --------- npm包配置文件
postcss.config.js ---- postcss样式处理配置文件
README.md ------------ 自述文件
vue.config.js -------- vue-cli配置文件
yarn.lock ------------ npm依赖版本锁
</code></pre></div><h3 id="模块打包"><a href="#模块打包" aria-hidden="true" class="header-anchor">#</a> 模块打包</h3> <p>Admincraft 的模块应该导出一个<code>init</code>函数。如果函数内部有异步操作，比如使用了<code>$addRemoteLib</code>API 来加载远程库，您可能需要让模块函数返回一个 Promise 来更好的控制异步流程。模块加载时此函数会被执行，接收的第一个参数是 <code>admincraft</code> 实例。使用 <code>admincraft</code> 实例方法，模块可以自行控制要加载的数据。</p> <p>下面是一个完整的模块打包入口例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// init.js</span>
<span class="token comment">// 导入模块数据</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">'./router/routes'</span>
<span class="token keyword">import</span> storeModule <span class="token keyword">from</span> <span class="token string">'./store/storeModule'</span>
<span class="token keyword">import</span> libs <span class="token keyword">from</span> <span class="token string">'./config/libs'</span>

<span class="token comment">// 从package.json中获取模块名称</span>
<span class="token keyword">let</span> moduleName <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name

<span class="token comment">// 动态获取模块js库的引用地址</span>
<span class="token keyword">let</span> i<span class="token punctuation">,</span> moduleServerUrl
<span class="token keyword">if</span> <span class="token punctuation">(</span>
  <span class="token punctuation">(</span>i <span class="token operator">=</span> window<span class="token punctuation">.</span>document<span class="token punctuation">.</span>currentScript<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
  <span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>src<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/(.+\/)[^/]+\.js$/</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  moduleServerUrl <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 导出模块init函数，当内部有异步操作时返回Promise</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token parameter">admincraft</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 注册路由</span>
    admincraft<span class="token punctuation">.</span><span class="token function">$addRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleName <span class="token operator">+</span> <span class="token string">'：路由注册完成'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 注册状态树</span>
    admincraft<span class="token punctuation">.</span><span class="token function">$addStore</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">,</span> storeModule<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleName <span class="token operator">+</span> <span class="token string">'：状态注册完成'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 注册菜单</span>
    admincraft<span class="token punctuation">.</span><span class="token function">$addMenus</span><span class="token punctuation">(</span>routes<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleName <span class="token operator">+</span> <span class="token string">'：菜单注册完成'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> <span class="token function-variable function">getRemoteLibUrlList</span> <span class="token operator">=</span> <span class="token parameter">libs</span> <span class="token operator">=&gt;</span>
      libs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> serverUrl <span class="token operator">+</span> <span class="token string">'libs/'</span> <span class="token operator">+</span> item<span class="token punctuation">)</span>
    <span class="token comment">// 注册libs</span>
    admincraft
      <span class="token punctuation">.</span><span class="token function">$addRemoteLib</span><span class="token punctuation">(</span><span class="token function">getRemoteLibUrlList</span><span class="token punctuation">(</span>libs<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>moduleName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">模块加载完成`</span></span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="模块开发"><a href="#模块开发" aria-hidden="true" class="header-anchor">#</a> 模块开发</h3> <p>从上文可知，代码打包成一个 Admincraft 模块可以用一个导出函数的入口文件<code>init.js</code>来实现。那作为一个 Admincraft 模块，我们如何去运行开发呢？</p> <p>其实很简单，像传统的 Vue 工程一样，我们从<code>main.js</code>文件出发。我们只需要在我们的 <code>main.js</code> 文件中导入模块要导出的初始化函数（<code>init.js</code> ）和 <code>Admincraft</code>，我们当前开发服务所运行的代码就是一个 Admincraft 项目，我们当然就可以使用 Admincraft 创建实例，并在<a href="/admincraft/api/#admincraft-add">实例化前添加我们的模块</a>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> Admincraft <span class="token keyword">from</span> <span class="token string">'admincraft'</span>
<span class="token keyword">import</span> showCase <span class="token keyword">from</span> <span class="token string">'./init'</span>
<span class="token comment">// 添加一个模块</span>
Admincraft<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>showCase<span class="token punctuation">)</span>
<span class="token comment">// 创建实例</span>
<span class="token keyword">let</span> appElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Admincraft</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">'Showcase'</span><span class="token punctuation">,</span>
  logo<span class="token punctuation">:</span> <span class="token punctuation">{</span> text<span class="token punctuation">:</span> <span class="token string">'showcase演示'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>appElement<span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>$el<span class="token punctuation">)</span>
</code></pre></div><p>然后，就能正常开发了，任何模块相关代码改动都会及时的更新在实例中。</p> <p>这样在开发阶段既能同步使用 Admincraft 提供的 API，组件，布局等能力，又能保证开发出的模块能完美被其他 Admincraft 项目加载。</p> <h2 id="事件总线"><a href="#事件总线" aria-hidden="true" class="header-anchor">#</a> 事件总线</h2> <p>为了提高模块与模块，模块与框架之间通信的灵活性，Admincraft 特别引入了事件总线。</p> <p>事件总线本质上是 Vue 原型对象上的一个对象 <code>eventBus</code>，我们可以用来监听和触发一些事件。</p> <p>每个模块需要提供自己的<a href="/admincraft/appendix/#事件列表">事件列表</a>以供其他模块监听。反之，也可根据其他模块提供的事件列表按需监听。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>为表明事件的不变性，Admincraft 约定使用常量标识事件名称，事件名称多个单词通过下划线<code>_</code>连接。</p></div> <h3 id="触发事件"><a href="#触发事件" aria-hidden="true" class="header-anchor">#</a> 触发事件</h3> <p>我们使用$eventBus.emit()方法可以触发一个自定义事件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'EVENT_NAME'</span><span class="token punctuation">,</span> payloadData<span class="token punctuation">)</span>
</code></pre></div><h3 id="监听事件"><a href="#监听事件" aria-hidden="true" class="header-anchor">#</a> 监听事件</h3> <p>我们使用$eventBus.on()方法可以监听一个自定义事件，同一个事件可以重复监听多次。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'EVENT_NAME'</span><span class="token punctuation">,</span> <span class="token parameter">payloadData</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="取消监听"><a href="#取消监听" aria-hidden="true" class="header-anchor">#</a> 取消监听</h3> <p>我们使用$eventBus.off()方法可以监听一个自定义事件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$eventBus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'EVENT_NAME'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="发起异步请求"><a href="#发起异步请求" aria-hidden="true" class="header-anchor">#</a> 发起异步请求</h2> <p>根据业务接口发起异步请求获取数据，是前后端分离的系统最重要的功能之一。Admincraft 内部封装了强大易用的 http 网络请求库<a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">axios<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，并在实例化时赋化身为<code>$http</code>对象，我们使用<code>$http</code>发起请求就像使用 axios 一样，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$http
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'api/path'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    params<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>除了在 Admincraft 实例化时可以传入 http 配置，我们在使用实例方法<code>$http</code>时也可以随时修改请求配置，发起请求时传入的配置优先级大于实例化配置。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$http
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'api/path'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    params<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    timeout<span class="token punctuation">:</span> <span class="token number">5000</span> <span class="token comment">// 当前接口的超时时间就会延长至5000ms</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/admincraft/assets/js/app.7cbdb45c.js" defer></script><script src="/admincraft/assets/js/3.4833b8e4.js" defer></script>
  </body>
</html>
